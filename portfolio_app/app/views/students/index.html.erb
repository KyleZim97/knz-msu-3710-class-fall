<p style="color: green"><%= notice %></p>

<h1>Students</h1>

<!-- Search form -->
<%= form_with(url: students_path, method: :get, local: true) do %>
  <div class="mb-3 w-25">
    <!-- Major field pulling from the majors table with a default blank option -->
    <%= label_tag :major, "Major" %>
    <%= select_tag :major, options_from_collection_for_select(Major.all, "name", "name", params[:major]), class: "form-select", prompt: "Please select a major" %>
  </div>

  <div class="mb-3 w-25">
    <!-- Graduation Date comparison field (Select Option/Before/After) -->
    <%= label_tag :date_comparison, "Graduation Date (Before/After)" %>
    <%= select_tag :date_comparison, options_for_select([['Select Option', ''], ['Before', 'before'], ['After', 'after']], params[:date_comparison]), class: "form-select" %>
  </div>

  <div class="mb-3 w-25">
    <!-- Graduation Date field -->
    <%= label_tag :graduation_date, "Graduation Date" %>
    <%= date_field_tag :graduation_date, params[:graduation_date], class: "form-control" %>
  </div>

  <!-- Search button -->
  <%= submit_tag "Search", class: "btn btn-primary" %>

  <!-- Show All button -->
  <%= button_tag "Show All", type: :submit, name: 'show_all', value: '1', class: "btn btn-secondary" %>
<% end %>

<!-- Show students only if a search is completed -->
<% if params[:major].present? || params[:date_comparison].present? && params[:graduation_date].present? %>
  <div id="students">
    <% if @students.any? %>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Major</th>
            <th>Graduation Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @students.each_with_index do |student| %>
            <tr>
              <td><%= student.first_name %></td>
              <td><%= student.last_name %></td>
              <td><%= student.major %></td>
              <td><%= student.graduation_date.strftime("%B %d, %Y") if student.graduation_date %></td>
              <td>
                <%= link_to "Show", student_path(student), class: "btn btn-info" %>
                <%= link_to "Edit", edit_student_path(student), class: "btn btn-warning" %>
                <%= link_to "Delete", student_path(student), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>No students found</p>
    <% end %>
  </div>
<% else %>
  <p>Please perform a search to display students.</p>
<% end %>

<!-- Show all students if "Show All" button is clicked -->
<% if params[:show_all].present? %>
  <div id="students">
    <% if @students.any? %>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Major</th>
            <th>Graduation Date</th>
            <th>Actions</th>
          </tr>
        </thead>
          <tbody>
            <% @students.each_with_index do |student| %>
              <tr>
                <td><%= student.first_name %></td>
                <td><%= student.last_name %></td>
                <td><%= student.major %></td>
                <td><%= student.graduation_date %></td>
                <td>
                  <%= link_to 'Show', student_path(student), class: 'btn btn-info' %>
                  <%= link_to 'Edit', edit_student_path(student), class: 'btn btn-warning' %>
                  <%= link_to 'Delete', student_path(student), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
                </td>
              </tr>
            <% end %>
          </tbody>
      </table>
    <% else %>
      <p>No students found</p>
    <% end %>
  </div>
<% end %>

<!-- New student link -->
<%= link_to "New student", new_student_path, class: "btn btn-primary" %>